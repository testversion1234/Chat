<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Netiquette-Rollenspiel v5 – Chat + Score</title>
<style>
  :root{--ink:#111827;--muted:#6b7280;--bg:#f6f7fb;--card:#fff;--accent:#2563eb;--ok:#10b981;--warn:#ef4444;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{background:linear-gradient(90deg,#4f46e5,#2563eb);color:#fff;padding:18px 20px;text-align:center}
  header h1{margin:6px 0 0;font-size:1.15rem}
  header .scorebox{display:inline-block;margin-top:8px;padding:6px 12px;border-radius:999px;background:rgba(255,255,255,.18);backdrop-filter:blur(6px)}
  main{max-width:920px;margin:16px auto;padding:0 12px 24px}
  .card{background:var(--card);border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.06);padding:16px;margin-bottom:14px}
  .row{display:flex;gap:12px;margin:10px 0}
  .bot,.you{max-width:78%;padding:10px 12px;border-radius:12px;line-height:1.45}
  .bot{background:#eef2ff;border-top-left-radius:0}
  .you{background:#e5fff4;border-top-right-radius:0;margin-left:auto}
  .muted{color:var(--muted);font-size:.92rem}
  .controls{display:flex;gap:8px;margin-top:10px}
  input[type="text"]{flex:1;padding:12px;border:1px solid #d1d5db;border-radius:10px}
  .btn{border:0;border-radius:10px;padding:12px 14px;background:var(--accent);color:#fff;cursor:pointer}
  .hint{font-size:.86rem;margin-top:6px;color:#374151}
  .tag{display:inline-block;font-size:.8rem;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#3730a3;margin-right:6px}
  .good{color:var(--ok)} .bad{color:var(--warn)}
  .summary{font-size:.9rem}
  .summary strong{display:inline-block;min-width:150px}
</style>
</head>
<body>
  <header>
    <div class="scorebox">Score: <span id="score">0</span></div>
    <h1>Netiquette-Rollenspiel · Chat mit Feedback</h1>
    <div class="muted">Schreibe selbst – der Bot prüft Ton & Netiquette.</div>
  </header>
  <main>
    <section class="card" id="chatCard">
      <div id="chat"></div>
      <div class="controls">
        <input id="userText" type="text" placeholder="Schreibe deine Antwort (höflich, keine ALL CAPS/!!!, Emojis sparsam)…">
        <button class="btn" id="send">Senden</button>
      </div>
      <div class="hint muted">Belohnt: Ich-Botschaft, Nachfragen, Deeskalation · Abzug: BRÜLLEN (ALL CAPS), !!!/???-Flut, Emoji-Flut, Unhöfliches, DU-Unterstellung.</div>
    </section>

    <section class="card">
      <div class="tag">Live-Auswertung</div>
      <div class="summary" id="summary"></div>
    </section>
  </main>

<script>
let score = 0;
const chat = document.getElementById('chat');
const input = document.getElementById('userText');
const sendBtn = document.getElementById('send');
const scoreEl = document.getElementById('score');
const summary = document.getElementById('summary');

const mistakes = {caps:0,punct:0,emoji:0,rude:0,du:0};

function addBot(text){
  const row = document.createElement('div'); row.className = 'row';
  const bubble = document.createElement('div'); bubble.className='bot'; bubble.textContent = text;
  row.appendChild(bubble); chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
}
function addYou(text){
  const row = document.createElement('div'); row.className='row';
  const bubble = document.createElement('div'); bubble.className='you'; bubble.textContent = text;
  row.appendChild(bubble); chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
}
function setScore(delta){ score += delta; scoreEl.textContent = score; }

// --- Unhöflichkeitsvokabeln ---
const RUDE_PATTERNS = [
  "doof", "bl[oö]d", "dep+p", "trottel", "dumm(?:kopf)?", "hirn?los", "spacko", "spinner", "nervig",
  "loser", "versager", "nullchecker", "peinlich", "armselig", "witzfigur",
  "schei[sß][s$]e", "sch\\*?ei[sß]e", "kacke", "mistst[üu]ck", "arsch", "arschloch", "arschkriecher",
  "penner", "pisser", "wichser", "kotzbrocken", "schlamper", "verpeilt",
  "halt\\s*(?:die|deine)\\s*(?:klappe|fresse|gosch[e]?|schnauze)",
  "h[äa]lt(?:'s|\\s*das)?\\s*maul",
  "reiß\\s*die\\s*(?:klappe|fresse)\\s*nicht",
  "leck\\s*mich",
  "verpiss\\s*dich",
  "zieh\\s*leine",
  "noob", "lappen", "opfer", "freak", "banause", "trott[ei]g",
  "du\\s*bist\\s*so\\s*(?:dumm|bl[oö]d|peinlich|nervig|unf[aä]hig)",
  "wie\\s*bl[oö]d\\s*bist\\s*du"
].map(s => new RegExp(s, "i"));

function analyzeMessage(msg){
  const result = {delta:0, notes:[]};

  if(/[A-ZÄÖÜ]{4,}/.test(msg) && (msg === msg.toUpperCase())){
    result.delta -= 1; result.notes.push("⚠️ Bitte nicht BRÜLLEN (ALL CAPS)."); mistakes.caps++; 
  }
  if((msg.match(/!/g)||[]).length >= 3 || (msg.match(/\?/g)||[]).length >= 3 || /[!?]{2,}/.test(msg)){
    result.delta -= 1; result.notes.push("⚠️ Zu viele Satzzeichen (!!!/???)."); mistakes.punct++; 
  }
  const emojis = msg.match(/[\u{1F300}-\u{1FAFF}]/gu) || [];
  if(emojis.length >= 3){ result.delta -= 1; result.notes.push("⚠️ Zu viele Emojis – nutze sie sparsam."); mistakes.emoji++; }
  if(RUDE_PATTERNS.some(rx => rx.test(msg))){
    result.delta -= 1; result.notes.push("⚠️ Unhöfliche/vulgäre Formulierung vermeiden."); mistakes.rude++;
  }
  if(/\bdu\b.*(bist|machst|hast).*(immer|nie|total|völlig|komplett|schlecht|falsch)/i.test(msg)){
    result.delta -= 1; result.notes.push("⚠️ Vermeide DU-Unterstellungen – lieber Ich-Botschaft."); mistakes.du++;
  }

  if(/ich\s*(finde|fühle|denke|verstehe|möchte|würde|kann|glaube|merke|habe|wünsche)/i.test(msg)){
    result.delta += 1; result.notes.push("✅ Gute Ich-Botschaft.");
  }
  if(/(kannst du|könntest du|was genau|wie meinst du|magst du|würdest du|hilft mir|erklär|erkläre|bitte genauer)/i.test(msg)){
    result.delta += 1; result.notes.push("✅ Nachfragen erkannt.");
  }
  if(/(sorry|entschuldigung|tut mir leid|lass uns|sachlich|ruhig|kein problem|klären|lösung|gemeinsam)/i.test(msg)){
    result.delta += 1; result.notes.push("✅ Deeskalation.");
  }

  return result;
}

function updateSummary(){
  summary.innerHTML = `
    <div><strong>BRÜLLEN:</strong> ${mistakes.caps} · <strong>!!!/???:</strong> ${mistakes.punct} · <strong>Emojis:</strong> ${mistakes.emoji} · <strong>Unhöflich:</strong> ${mistakes.rude} · <strong>DU-Unterstellung:</strong> ${mistakes.du}</div>
  `;
}

function handleSend(){
  const text = (input.value || "").trim();
  if(!text){ return; }
  addYou(text);

  const evaln = analyzeMessage(text);
  setScore(evaln.delta);

  if(evaln.notes.length){
    addBot(evaln.notes.join(" ")+" (Score: "+score+")");
  } else {
    addBot("👍 Sehr höflich! (Score: "+score+")");
  }

  input.value = "";
  updateSummary();
}

sendBtn.onclick = handleSend;
input.addEventListener("keydown", e => { if(e.key === "Enter") handleSend(); });

addBot('Paul: „Hä? Deine Aufgabe ist doch voll falsch! 🙄“ — Antworte höflich (Ich-Botschaft/Nachfrage/Deeskalation).');
updateSummary();
</script>
</body>
</html>
